

import("rtt_ros");
ros.import("oro_barrett_hw");

loadComponent("barrett_hw_manager","oro_barrett_hw::BarrettHWManager");
setActivity("barrett_hw_manager",0.001,HighestPriority,ORO_SCHED_RT)
loadService("barrett_hw_manager","rosparam");

barrett_hw_manager.rosparam.getAll();
barrett_hw_manager.rosparam.getAbsolute("robot_description");

barrett_hw_manager.configure();

barrett_hw_manager.configureWam7("wam");
barrett_hw_manager.configureHand("wam/bhand");

/* Set home positions */
barrett_hw_manager.wam.home_position[0] = 0.0;
barrett_hw_manager.wam.home_position[1] = -1.5708;
barrett_hw_manager.wam.home_position[2] = 0.0;
barrett_hw_manager.wam.home_position[3] = 3.1415;
barrett_hw_manager.wam.home_position[4] = 0.0;
barrett_hw_manager.wam.home_position[5] = -1.5708;
barrett_hw_manager.wam.home_position[6] = 1.5708;

/* Set home resolver positions */
barrett_hw_manager.wam.home_resolver_offset[0] =  0.42644;
barrett_hw_manager.wam.home_resolver_offset[1] = 0.62126;
barrett_hw_manager.wam.home_resolver_offset[2] = 0.96947;
barrett_hw_manager.wam.home_resolver_offset[3] = -1.23025;
barrett_hw_manager.wam.home_resolver_offset[4] = 1.81463;
barrett_hw_manager.wam.home_resolver_offset[5] = 0.59365;
barrett_hw_manager.wam.home_resolver_offset[6] = 2.4942;

/* Publish joint state to ROS */
stream("barrett_hw_manager.wam.joint_resolver_state_out",rostopic.connection("wam_resolver_states"));
stream("barrett_hw_manager.wam.joint_state_out",rostopic.connection("wam_joint_states"));
stream("barrett_hw_manager.hand.joint_state_out",rostopic.connection("hand_joint_states"));

barrett_hw_manager.start();

barrett_hw_manager.wam.read_resolver = 1

/* Calibrate joint positions */
// barrett_hw_manager.wam.calibrateNearHome()
